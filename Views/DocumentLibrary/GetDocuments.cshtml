@using NewZapures_V2.Models
@model List<DocumentLibraryMaster>
@{
    Layout = null;
}

@{
    if (Model != null)
    {


        <div class="col-lg-12" style="height:60vh; overflow-y:scroll">
            <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                <thead class="sticky">
                    <tr>
                        <th scope="col">
                            @*<div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="selectAll">
                                    <label class="custom-control-label" style="color: black;font-weight: 500;font-size: 13px;" for="selectAll">  Select All</label>

                                </div>*@
                            Select
                        </th>
                        <th scope="col" hidden>ID</th>
                        <th scope="col">Document Name</th>
                        <th scope="col">

                            @*<span class="custom-control custom-switch switch-primary">
                                    <input type="checkbox" class="custom-control-input" id="MandatoryAll">
                                    <label class="custom-control-label" for="MandatoryAll">Is Mandatory</label>
                                </span>*@
                            Is Mandatory
                        </th>
                        <th scope="col">Active</th>
                    </tr>
                </thead>
                <tbody>
                    @{


                        foreach (var item in Model)
                        {
                            string id = @item.Id.ToString();
                            var switchIsMandatory = "customSwitchPrimary" + @id;
                            var switchIsActive = "customSwitchDanger" + @id;
                            var checkboxId = "chkb" + @id;
                            <tr>
                                <td scope="col">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id=@checkboxId @(item.isSelected == 1 ? "checked" : "")>
                                        <label class="custom-control-label" for=@checkboxId></label>
                                    </div>
                                </td>
                                <td scope="col" hidden class="documentID">@item.Id</td>
                                <td scope="col" class="documentName">@item.DocumentName</td>
                                <td scope="col">
                                    <span class="custom-control custom-switch switch-primary">
                                        <input type="checkbox" class="custom-control-input isMandatoryorNot" id=@switchIsMandatory @(item.isMandatory == 1 ? "checked" : "")><label class="custom-control-label" for=@switchIsMandatory></label>
                                    </span>
                                </td>
                                <td scope="col">
                                    <span class="custom-control custom-switch switch-danger">
                                        <input type="checkbox" class="custom-control-input isActiveorNot" id=@switchIsActive @(item.isActive == 1 ? "checked" : "")><label class="custom-control-label" for=@switchIsActive></label>
                                    </span>


                                </td>
                            </tr>

                        }

                    }

                </tbody>
            </table>
        </div>

        <div class="row mt-4" id="saveButton">
            <div class="col-lg-12 text-right">
                <input type="button" class="btn btn-primary" id="btnSaveCountry" value="Save Details" title="Save Details" onclick="SaveData();" />
            </div>
        </div>
    }
}



<script>

    var documentList = [];

    $("[id^=chkb]").each(function () {
        var companyType = $('#Companytype').val();
        var ischecked = $(this).is(':checked');
        var $row = $(this).closest("tr");    // Find the row
        var documentID = $row.find(".documentID").text(); // Find the text
        var documentName = $row.find(".documentName").text(); // Find the text
        var isMandatoryorNot = $row.find(".isMandatoryorNot").is(':checked'); //Gets the checked status
        var isActiveorNot = $row.find(".isActiveorNot").is(':checked'); // Gets the checked status
        if (ischecked) {
            documentList.push({
                DocumentID: documentID,
                DocumentName: documentName,
                isMandatory: isMandatoryorNot,
                isActive: isActiveorNot,
                CompanyID: companyType
            });
        }
    });

    // console.table(documentList);


    $("[id^=chkb]").click(function () {

        var companyType = $('#Companytype').val();
        var ischecked = $(this).is(':checked');
        var $row = $(this).closest("tr");    // Find the row
        var documentID = $row.find(".documentID").text(); // Find the text
        if (ischecked) {
            var documentName = $row.find(".documentName").text(); // Find the text
            var isMandatoryorNot = $row.find(".isMandatoryorNot").is(':checked'); //Gets the checked status
            var isActiveorNot = $row.find(".isActiveorNot").is(':checked'); // Gets the checked status

            documentList.push({
                DocumentID: documentID,
                DocumentName: documentName,
                isMandatory: isMandatoryorNot,
                isActive: isActiveorNot,
                CompanyID: companyType
            });
        }
        else {
            documentList = documentList.filter(function (e) {
                return e.DocumentID !== documentID
            })
        }
        //console.table(documentList);
    });

    $("[id^=customSwitchPrimary]").click(function () {

        var $row = $(this).closest("tr");    // Find the row
        var documentID = $row.find(".documentID").text(); // Find the text

        var documentName = $row.find(".documentName").text(); // Find the text
        var isMandatoryorNot = $row.find(".isMandatoryorNot").is(':checked'); //Gets the checked status
        var isActiveorNot = $row.find(".isActiveorNot").is(':checked'); // Gets the checked status

        documentList = documentList.map(obj => {
            if (obj.DocumentID === documentID) {
                obj.isMandatory = isMandatoryorNot;
                obj.isActive = isActiveorNot;
            }
            return obj
        })
        console.table(documentList);
    });

    $("[id^=customSwitchDanger]").click(function () {

        var $row = $(this).closest("tr");    // Find the row
        var documentID = $row.find(".documentID").text(); // Find the text

        var documentName = $row.find(".documentName").text(); // Find the text
        var isMandatoryorNot = $row.find(".isMandatoryorNot").is(':checked'); //Gets the checked status
        var isActiveorNot = $row.find(".isActiveorNot").is(':checked'); // Gets the checked status

        documentList = documentList.map(obj => {
            if (obj.DocumentID === documentID) {
                obj.isMandatory = isMandatoryorNot;
                obj.isActive = isActiveorNot;
            }
            return obj
        })
        console.table(documentList);
    });

    function SaveData() {
        var companyType = $('#Companytype').val();

        if (companyType == 0) {
            Swal.fire({
                position: 'center',
                icon: 'error',
                title: 'Please Select CompanyType...!',
                allowOutsideClick: false,
                showCloseButton: true,
                showConfirmButton: false
            });
        }
        else {

            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: GetglobalDomain() + "/DocumentLibrary/SaveDocumentList",
                dataType: 'json',
                type: 'Post',
                cache: false,
                data: JSON.stringify(documentList),
                success: function (data) {
                    console.log(data);

                    if (data.StatusCode === 1) {
                        Swal.fire({
                            position: 'center',
                            icon: 'success',
                            title: data.Message,
                            allowOutsideClick: false,
                            showCloseButton: true,
                            showConfirmButton: false
                        });
                        clearAll();
                    }
                },
                error: function (d) {
                    console.log(d);
                }
            });
        }

    }

    function clearAll() {
        documentList = [];
        $('#tbldocumentList').css('display', 'none');
        $('#saveButton').css('display', 'none');
        $('#Companytype').removeAttr("disabled");


        var url = GetglobalDomain() + "/DocumentLibrary/Index";

        window.location.href = url;
    }
</script>