@using NewZapures_V2.Models
@model List<ServiceProviderRateconfiguration>
@{
    ViewBag.Title = "Service Provider Rate Master";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<CustomMaster> UnitType = new List<CustomMaster>();
    List<CustomMaster> OperaterName = new List<CustomMaster>();
    if (ViewBag.UnitType != null)
    {
        UnitType = (List<CustomMaster>)ViewBag.UnitType;
    }
    if (ViewBag.OperaterName != null)
    {
        OperaterName = (List<CustomMaster>)ViewBag.OperaterName;
    }
}

@section styles{-->  @*@Styles.Render("~/bundles/datatable");*@\
<link href="~/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

}
<div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <div class="float-right">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">Zapures</li>
                    <li class="breadcrumb-item">Service Provider Rate</li>
                    <li class="breadcrumb-item active">Details</li>
                </ol>
            </div>
            <h4 class="page-title">@ViewBag.Title</h4>
        </div><!--end page-title-box-->
    </div><!--end col-->
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mt-0 header-title float-left">Rate Of Service Provider</h4>
                <a class="btn btn-gradient-secondary waves-effect waves-light float-right" href="@Url.Action("ServiceProviderIndex", "Commission")"><i class="fas fa-arrow-left"></i> Provider List</a>


            </div>
            <div class="card-body">
                @using (Html.BeginForm("ServiceProviderRateMaster", "Commission", FormMethod.Post, new { @class = "formcreateupdate", @id = "frmAddUpdate", enctype = "multipart/form-data" }))
                {
                    <input name="ServiceProviderId" id="ServiceProviderId" type="hidden" value="@ViewBag.Id">

                    <div class="form-group is-empty row">
                        <div class="col-md-3">
                            <select class="singleselect" name="CommissionType" id="CommissionType" required>
                                <option value="">Select Commission Type</option>
                                @{
                                    foreach (var item in UnitType)
                                    {
                                        <option value="@item.Id">@item.text</option>
                                    }
                                }
                            </select>

                        </div>
                        <div class="col-md-3">
                            <input type="text" id="CommissionRate" name="CommissionRate" placeholder="Enter Commission Rate" value="" class="form-control" required>

                        </div>
                        <div class="col-md-3">
                            <select class="singleselect" name="CommissionApplicableId" id="CommissionApplicableId" >
                                <option value="">Select Commission Applicable </option>
                                @{
                                  
                                        <option value="1">Transaction Amount</option>
                                 
                                }
                            </select>

                        </div>
                        <div class="col-md-3">
                            <select class="singleselect" name="OperaterId" id="OperaterId" required>
                                <option value="">Select Operater </option>
                                @{
                                    foreach (var item in OperaterName)
                                    {
                                        <option value="@item.Id">@item.text</option>
                                    }
                                }
                            </select>

                        </div>
                    </div>
                    <div class="form-group is-empty row">
                        <div class="col-md-4">
                            @*@Html.TextBoxFor(model => model.Fromdate, new { @Value = Model.Fromdate, @style = "width:100%", type = "date" })*@
                            @*@Html.TextBox("FromDate", Model.Fromdate.ToString(), "{0:yyyy-MM-dd}", new { @style = "width:100%", type = "date" })*@
                            <input type="date" class="form-control" name="FromDate" value="" id="FromDate" required />
                            <small id="msgshow" class="col-sm-12 control-label" style="color:red;text-align: unset;">From Date</small>
                        </div>
                        @*</div>
                            <div class="form-group is-empty row">*@
                        @*<label for="nameInput" class="col-sm-2 control-label">To Date</label>*@
                        <div class="col-md-4">
                            <input type="date" class="form-control" name="ToDate" value="" id="ToDate" required disabled />
                            <small id="msgshow" class="col-sm-12 control-label" style="color:red;text-align: unset;">To Date</small>
                        </div>
                        <div class="col-md-4 row" style="display:none">

                            <label for="nameInput" class="col-sm-4 control-label">Active</label>
                            <div class="col-sm-2 custom-control custom-switch switch-success ">
                                <input type="checkbox" class="custom-control-input" id="Status" name="Status" value="0">
                                <label class="custom-control-label" for="Status"></label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group is-empty">
                        <button class="btn btn-primary" type="button" id="Reset"> Reset </button>
                        <button class="btn btn-primary" type="submit"> Save </button>
                    </div>

                }

                <form class="form-parsley" action="#" autocomplete="off">
                    <table id="datatable-buttons" class="table table-striped table-bordered dt-responsive nowrap " style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Type Name</th>
                                <th>Operater Name</th>

                                <th>From Date</th>
                                <th>To Date</th>
                                <th>Commission Rate</th>



                                <th>Active</th>
                                <th>Action</th>


                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var i = 1;
                                foreach (var item in Model)
                                {
                                    <tr id="tr_@item.ServiceProviderRateConfigurationId">
                                        <td>@i</td>
                                        <td>
                                            @item.TypeName
                                            @{ 
                                                if(item.CommissionApplicableId==1)
                {
                                                    <br />
                                                                                        <b style="color:brown;background-color:antiquewhite;">Transaction Amount</b>
                }
                                            }
                                        </td>
                                        <td>
                                            @item.OperaterName
                                        </td>
                                        <td>
                                            @item.FromDate
                                        </td>
                                        <td>
                                            @item.ToDate
                                        </td>
                                        <td>
                                            @item.CommissionRate
                                        </td>
                                        <td>
                                            <div class="form-check form-switch">
                                                @{if (item.Status == 1)
                                                    {
                                                        <input id="ServiceProviderRate-@item.ServiceProviderRateConfigurationId" class="form-check-input ChangeStatus" type="checkbox" data-id="ServiceProviderRate-@item.ServiceProviderRateConfigurationId" name="@item.ServiceProviderRateConfigurationId" value="@item.Status" checked disabled>
                                                    }
                                                    else
                                                    {
                                                        <input id="ServiceProviderRate-@item.ServiceProviderRateConfigurationId" class="form-check-input ChangeStatus" type="checkbox" data-id="ServiceProviderRate-@item.ServiceProviderRateConfigurationId" name="@item.ServiceProviderRateConfigurationId" value="@item.Status">

                                                    }
                                                }

                                            </div>




                                        </td>
                                        <td>
                                           @{ if (item.Status == 0)
                                               {
                                            <a id="btnDeactive_@item.ServiceProviderRateConfigurationId" class="Deleteclass" name="2" data-id="@item.ServiceProviderRateConfigurationId" onclick="DeleteData(@item.ServiceProviderRateConfigurationId)" title="Delete"><i class="fas fa-times text-danger font-16"></i></a>
                                                   }
                                               }
                                        </td>

                                    </tr>
                                    i++;
                                }
                            }
                        </tbody>
                    </table>
                </form>


            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/plugins/datatables/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/dataTables.bootstrap4.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/dataTables.buttons.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/buttons.bootstrap4.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/jszip.min.js" type="text/javascript"></script>
    @*<script src="~/plugins/datatables/pdfmake.min.js" type="text/javascript"></script>*@
    <script src="~/plugins/datatables/vfs_fonts.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/buttons.html5.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/buttons.print.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/buttons.colVis.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/dataTables.responsive.min.js" type="text/javascript"></script>
    <script src="~/plugins/datatables/responsive.bootstrap4.min.js" type="text/javascript"></script>
    <script src="~/scripts/pages/jquery.datatable.init.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <script type="text/javascript">
        $(".singleselect").select2();




        $('input[type="checkbox"]').change(function () {
            var id = $(this).val() == 0 ? 1 : 0;
            $(this).val(id)

        });
        $("#FromDate").blur(() => {
            var fromdate = $("#FromDate").val();
            var ToDate = $("#ToDate").val();
            if (fromdate != '') {
                $("#ToDate").attr('min', fromdate);
                $("#ToDate").attr('disabled', false);
                if (ToDate > fromdate) {
                    $("#ToDate").val('');
                }

            }
            else {
                $("#ToDate").attr('min', '');
                $("#ToDate").val('');
                $("#ToDate").attr('disabled', true);
            }
        });
        document.getElementById('Reset').addEventListener('click', () => {
            $('#FromDate').val('');
            $("#ToDate").val('');
            $("#ToDate").attr('disabled', true);
        });
    </script>
    <script type="text/javascript">
        $(".ChangeStatus").change(function () {
            debugger;
            var id = $(this).data("id");
            var item = id.split('-');
            var type = parseInt($(this).val());

            var Params = JSON.stringify(
                {
                    TableId: item[0],
                    Type: type,
                    Id: item[1]
                });

            $.ajax({
                url: "/Commission/ServiceProviderChangeStatus",//globaUserProperties.domain +
                type: 'POST',
                dataType: "json",
                contentType: "application/json",
                data: Params,
                success: function (response) {
                    debugger;
                    if (response.isvalid == 1) {
                        var msg = ' Record Status Changes Successfully';
                        //if (type == 1) {
                        //    $("#" + id).val(0);
                        //    /* $(this).val('0');*/
                        //    msg = 'Status De-Active Successfully';
                        //}
                        //else {
                        //    $("#" + id).val(1);
                        //    /* $(this).val('1');*/
                        //    msg = 'Status Active Successfully';
                        //}
                        Swal.fire({
                            position: 'center',
                            icon: 'success',
                            title: msg,
                            showConfirmButton: false,
                            timer: 3000
                        })
                        setTimeout(function () {
                            location.reload();
                        }, 2500);

                    }






                }
            });

        });
        function DeleteData(Id) {
            var Id = Id;

            /*  var TypeId = $(this).attr("name");*/
            $.confirm({

                title: 'Remove Confirmation',
                content: 'Are you sure to remove record',
                type: 'red',
                typeAnimated: true,
                animation: 'rotate',
                closeAnimation: 'scale',
                buttons: {
                    Confirm: {
                        text: 'YES',
                        btnClass: 'btn-red',
                        action: function () {



                            var Params = JSON.stringify({
                                TableId: 'tbl_ServiceProviderRateConfiguration',
                                Id: Id,
                                Type: 2


                            });
                            /* ShowBALoader("LoaderBASinup1");*/
                            $.ajax({
                                url: "/Commission/ServiceProviderChangeStatus",//globaUserProperties.domain +
                                type: 'POST',
                                dataType: "json",
                                data: Params,
                                contentType: "application/json",
                                success: function (response) {


                                    debugger;
                                    if (response.IsValid = 1) {
                                        Swal.fire({
                                            position: 'center',
                                            icon: 'success',
                                            title: 'Reord Deleted Successfully',
                                            showConfirmButton: false,
                                            timer: 3000
                                        })
                                        setTimeout(function () {
                                            location.reload();
                                        }, 2500);
                                    }

                                },

                            });

                        }
                    },
                    close: {
                        text: 'NO',
                        action: function () { }
                    }
                }
            });
        }
    </script>
}
