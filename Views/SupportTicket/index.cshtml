@using NewZapures_V2.Models
@{
    ViewBag.Title = "Support Ticket";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var Module = ViewBag.Module as List<Dropdown>;
    var Functionality = ViewBag.Functionality as List<Dropdown>;
    var Ticket = ViewBag.Ticket as List<Dropdown>;

}

@*@Styles.Render("~/bundles/datatable");*@
<link href="~/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">



@*@Scripts.Render("~/bundles/datatablejs")*@
<script src="~/plugins/datatables/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/dataTables.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/dataTables.buttons.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/buttons.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/jszip.min.js" type="text/javascript"></script>
@*<script src="~/plugins/datatables/pdfmake.min.js" type="text/javascript"></script>*@
<script src="~/plugins/datatables/vfs_fonts.js" type="text/javascript"></script>
<script src="~/plugins/datatables/buttons.html5.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/buttons.print.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/buttons.colVis.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/dataTables.responsive.min.js" type="text/javascript"></script>
<script src="~/plugins/datatables/responsive.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/scripts/pages/jquery.datatable.init.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
<script src="~/Content/globalDomain.js"></script>
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link href="~/Content/select2/css/select2.css" rel="stylesheet" />

<!DOCTYPE html>

<style>
    .sticky {
        position: sticky;
        top: 0;
        z-index: 1;
    }
</style>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
</head>
<body>
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">College Details</h1>
                </div><!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="javascript:void(0);">Master</a></li>
                        <li class="breadcrumb-item active">@ViewBag.Title</li>
                    </ol>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <section class="content">
        <div class="container-fluid">

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="form-group col-lg-12">
                                        <label for="example-text-input" class="col-sm-12" style="margin-left:-10px">Select Module</label>

                                        <select id="ddlModule">
                                            <option value="0" role=separator>Module</option>
                                            @{
                                                if (Module != null)
                                                {
                                                    foreach (var item in Module)
                                                    {
                                                        <option value=@item.Id data-image="~/images/404.png">@item.Text</option>



                                                    }
                                                }
                                            }
                                        </select>

                                    </div>

                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group col-lg-12">
                                        <label for="example-text-input" class="col-sm-12" style="margin-left:-10px">Select Functionality</label>

                                        <select id="ddlFunctionality">
                                            <option value="0" role=separator>Functionality</option>
                                            @{
                                                if (Functionality != null)
                                                {
                                                    foreach (var item in Functionality)
                                                    {
                                                        <option value=@item.Id data-image="~/images/404.png">@item.Text</option>



                                                    }
                                                }
                                            }
                                        </select>

                                    </div>

                                </div>

                            </div>
                            <div class="row">
                                <div class="col-lg-4">
                                    <div class="form-group col-lg-12">
                                        <label for="example-text-input" class="col-sm-12" style="margin-left:-10px">Type Of Ticket</label>

                                        <div>
                                            <select class="form-control" id="ddlTicket" name="Division">
                                                <option value="">--Select --</option>
                                                <option value="1">Error</option>
                                                <option value="2">Bug</option>
                                                <option value="3">New</option>
                                                <option value="4">Changes</option>

                                            </select>
                                        </div>

                                    </div>

                                </div>

                            </div>

                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="col-lg-12">
                                        <div class="form-group col-lg-12">
                                            <input class="form-control" id="txtDescription" name="Decribe" />

                                        </div>

                                    </div>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="col-lg-12">
                                        <div class="form-group col-lg-12">
                                            <label for="file1">Attach your issue screen shot</label>
                                            <input type="file" id="fileaadhaar" style="border: 0px solid #e8ebf3" name="attachment" data-input="true" data-buttonname="btn btn-info" data-iconname="fa fa-upload mr" class="form-control filestyle" />
                                            <span id="attachment"></span>

                                        </div>

                                    </div>

                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-8">
                                </div>
                                <div class="col-lg-4">
                                    <div class="pull-right" style="text-align: end;">
                                        <a href="" class="btn btn-default">DISCARD</a>

                                        <input type="button" class="btn btn-primary" id="btnSaveData" onclick="SaveData();" value="Add" title="Add" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#ddlModule").select2();
            $("#ddlFunctionality").select2();
            $("#ddlTicket").select2();
        });

        function SaveData() {
            var Module = $('#ddlModule').val();
            var Functionality = $('#ddlFunctionality').val();
            var Ticket = $('#ddlTicket').val();
            var Description = $('#txtDescription').val();
            var Attachment = $('#txtAttachment').val();

            var isSaved = true;
            var Data = {
                ModuleId: 0,
                FunctionalityId: 0,
                TicketId: 0,
                Description: '',
                Attachment: ''

            }

            if (Module == 0) {
                Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Please Select Module...!',
                    allowOutsideClick: false,
                    showCloseButton: true,
                });
                isSaved = false;
            }
            else if (Functionality == 0) {
                Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Please Select Functionality...!',
                    allowOutsideClick: false,
                    showCloseButton: true,
                });
                isSaved = false;
            }
            else if (Ticket == 0) {
                Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Please Select Ticket...!',
                    allowOutsideClick: false,
                    showCloseButton: true,
                });
                isSaved = false;
            }
            else if (Description == '') {
                Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Please Select Course...!',
                    allowOutsideClick: false,
                    showCloseButton: true,
                });
                isSaved = false;
            }

            else {
                Data.ModuleId = parseInt(Module);
                Data.FunctionalityId = parseInt(Functionality);
                Data.TicketId = parseInt(Ticket);
                Data.Description = Description;

            }
            var d = JSON.stringify(Data)
            if (isSaved) {
                $.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    url: GetglobalDomain() + "/SupportTicket/SaveData",
                    dataType: 'json',
                    type: 'Post',
                    cache: false,
                    data: JSON.stringify(Data),
                    success: function (data) {
                        console.log(data.Type);
                        console.log(data);
                        var type = data.Type;
                        if (data.StatusCode === 1 && data.Message == " Already Exists") {
                            Swal.fire({
                                position: 'center',
                                icon: 'error',
                                title: type + data.Message + '...!',
                                allowOutsideClick: false,
                                showCloseButton: true
                            });
                        }
                        if (data.StatusCode === 1 && data.Message == " Inserted Successfully") {
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: type + data.Message + '...!',
                                allowOutsideClick: false,
                                showCloseButton: true
                            });
                        }

                        setTimeout(function () {
                            var url = GetglobalDomain() + "/SupportTicket/Index";
                            window.location.href = url;
                        }, 700)


                    },
                    error: function (d) {
                        //alert(d);
                    }
                });
            }
        }
    </script>

</body>
</html>
