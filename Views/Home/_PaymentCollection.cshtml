
@using NewZapures_V2.Models.Others
@model NewZapures_V2.Models.PartyPaymentCollect
<div id="modal-PaymentCollection">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            @*@using (Html.BeginForm("AddCollectMoney", "Home", FormMethod.Post, new { id = "modal-addedit-CollectMoney" }))
                {*@
            @Html.HiddenFor(x => x.partsummary.PartyId)
            @Html.HiddenFor(x => x.partsummary.OrderId)
            @Html.HiddenFor(x => x.GrandTotal)
            @Html.HiddenFor(x => x.partsummary.payTrackingId)
            @Html.Partial("_ModalHeader", new ModalHeader { Heading = "Payment Collect" })
            <div class="box panel panel-default">
                <div class="box-body collapse" style="display: block; margin-top: 20Px">
                    <div class="row">
                        <div class="col-lg-12">
                            @*<h4 class="mt-0 header-title">Services</h4>
                                <p class="text-muted mb-3"></p>*@
                            <div class="col-12">
                                <div class="form-group">
                                    <!--<div class="row">
                                    <div class="col-lg-3 col-6 mb-2 mb-lg-0">
                                        <select class="form-control">
                                            <option>Select</option>
                                            <option>Vivek7635</option>
                                        </select>
                                    </div>-->
                                    <!--end col-->
                                    <!--</div>
                                    <br />-->
                                    <div class="row">
                                        <div class="col-lg-6 col-6">
                                            @*<label for="pro-rate">Last Name</label>*@
                                            @Html.TextBoxFor(modal => modal.partsummary.OrderId, null, new { @class = "mr-3 form-control", @maxlength = "250", @readonly = "readonly" })

                                        </div><!--end col-->
                                        <div class="col-lg-6 col-6 mb-2 mb-lg-0">
                                            @Html.TextBoxFor(modal => modal.partsummary.Name, null, new { @class = "mr-3 form-control", @maxlength = "250", @readonly = "readonly" })

                                        </div><!--end col-->
                                    </div><br />
                                    <div class="row">
                                        <div class="col-lg-6 col-6 mb-2 mb-lg-0">
                                            @*<label for="pro-end-date">Middle Name</label>*@
                                            @Html.TextBoxFor(modal => modal.partsummary.MobileNumber, null, new { @class = "mr-3 form-control", @maxlength = "250", @readonly = "readonly" })

                                        </div><!--end col-->
                                        <div class="col-lg-6 col-6">
                                            @*<label for="pro-rate">Last Name</label>*@

                                            @Html.TextBoxFor(modal => modal.partsummary.Email, null, new { @class = "mr-3 form-control", @maxlength = "250", @readonly = "readonly" })
                                        </div><!--end col-->
                                    </div><!--end row-->
                                </div><!--end form-group-->
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-lg-12 col-6 mb-2 mb-lg-0">
                                            @Html.TextArea("Address", new { @class = "mr-3 form-control", @rows = "3", @readonly = "readonly" })
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="row">
                                        @*@if (Model.ServiesDetailsList.Where(s => s.ServiceType == "service").ToList().Count > 0)
                                            {*@
                                        <div class="col-12 table-rep-plugin">
                                            <div class="table-responsive mb-0" data-pattern="priority-columns">
                                                <table id="tech-companies-1" class="table table-striped mb-0">
                                                    <thead class="panel-info">
                                                        <tr style="background-color: #cacdd2">
                                                            <th>Service</th>
                                                            <th>Charge Type</th>
                                                            <th style="text-align:right">Charge</th>
                                                            @*<th style="text-align:right">GST</th>*@
                                                            @*<th style="text-align:right">IGST</th>
                                                                <th style="text-align:right">CGST</th>
                                                                <th style="text-align:right">Commision</th>
                                                                <th style="text-align:right">Service Charge</th>
                                                                <th style="text-align:right">Courier Charge</th>*@
                                                            @*<th data-priority="3">GST</th>*@
                                                            <th style="text-align:right">Total Charge</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>


                                                        @foreach (var item in Model.ServiesDetailsList)
                                                        {
                                                            if (item.ServiceType == "service")
                                                            {
                                                                <tr>
                                                                    <td>@item.Service</td>
                                                                    <td>@item.ChargeType</td>
                                                                    <td style="text-align:right">@item.Charge</td>
                                                                    @*<td style="text-align:right">@item.GST</td>*@
                                                                    @*<td style="text-align:right">@item.IGST</td>
                                                                        <td style="text-align:right">@item.CGST</td>
                                                                        <td style="text-align:right">@item.Commision</td>
                                                                        <td style="text-align:right">@item.ServiceCharge</td>
                                                                        <td style="text-align:right">@item.CourierCharge</td>*@
                                                                    <td style="text-align:right">@item.TotalAmount</td>
                                                                </tr>
                                                            }
                                                        }

                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td></td>
                                                            <td></td>
                                                            <td style="text-align:right">GST</td>
                                                            <td style="text-align:right">@Model.serviceGst</td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                        @*}*@

                                        <div class="col-12 table-rep-plugin">
                                            <div class="table-responsive mb-0" data-pattern="priority-columns">
                                                <table id="tech-companies-1" class="table table-striped mb-0">
                                                    @if (Model.ServiesDetailsList.Where(s => s.ServiceType == "Hardware").ToList().Count > 0)
                                                    {
                                                        <thead style="background-color: #cacdd2">
                                                            <tr>
                                                                <th>Hardware</th>
                                                                <th>Charge Type</th>
                                                                <th style="text-align:right">Charge</th>
                                                                <th style="text-align:right">GST</th>
                                                                @*<th style="text-align:right">IGST</th>
                                                                    <th style="text-align:right">CGST</th>
                                                                    <th style="text-align:right">Commision</th>
                                                                    <th style="text-align:right">Service Charge</th>
                                                                    <th style="text-align:right">Courier Charge</th>*@
                                                                @*<th data-priority="3">GST</th>*@
                                                                <th style="text-align:right">Total Charge</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @foreach (var item in Model.ServiesDetailsList)
                                                            {
                                                                if (item.ServiceType == "Hardware")
                                                                {
                                                                    <tr>
                                                                        <td>@item.Service</td>
                                                                        <td>@item.ChargeType</td>
                                                                        <td style="text-align:right">@item.Charge</td>
                                                                        <td style="text-align:right">@item.GST</td>
                                                                        @*<td style="text-align:right">@item.IGST</td>
                                                                            <td style="text-align:right">@item.CGST</td>
                                                                            <td style="text-align:right">@item.Commision</td>
                                                                            <td style="text-align:right">@item.ServiceCharge</td>
                                                                            <td style="text-align:right">@item.CourierCharge</td>*@
                                                                        <td style="text-align:right">@Convert.ToDecimal(@item.Charge + @item.GST)</td>
                                                                    </tr>
                                                                }
                                                            }
                                                        </tbody>
                                                    }
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3"></td>
                                                            <td colspan="1" style="text-align:right">Grand Total</td>
                                                            <td style="text-align:right">@Model.GrandTotal</td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div><!--end card-body-->

                            <div class="card-body">
                                <div class="form-group row">
                                    <div class="col-md-3 resultscore">
                                        <div class="form-check-inline my-1">
                                            <div class="custom-control custom-radio">
                                                @Html.RadioButtonFor(modal => modal.collectMoney.PaymentMode, "703", new { @class = "custom-control-input", @checked = "checked", @id = "SelectCash", @onchange = "getValue(this)" })
                                                @*<input type="radio" id="SelectCash" name="collectMoney_PaymentMode" class="custom-control-input">*@
                                                <label class="custom-control-label" for="SelectCash">Cash</label>
                                            </div>
                                        </div>
                                        <div class="form-check-inline my-1" style="width:40%;float:right">
                                            <div class="custom-control custom-radio">
                                                @Html.RadioButtonFor(modal => modal.collectMoney.PaymentMode, "702", new { @class = "custom-control-input", @id = "SelectCheque", @onchange = "getValue(this)" })
                                                @*<input type="radio" id="SelectCheque" name="collectMoney_PaymentMode" class="custom-control-input">*@
                                                <label class="custom-control-label" for="SelectCheque">Cheque</label>
                                            </div>
                                        </div>
                                    </div> <!-- form-group -->
                                    <div class="col-9">
                                        <div class="form-group" id="divcheque" style="display:none">
                                            <div class="row">
                                                <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                    @Html.TextBoxFor(modal => modal.collectMoney.ChequeNumber, null, new { @class = "mr-3 form-control", @maxlength = "250", @placeholder = "Cheque Number" })
                                                    @*<input type="text" class="form-control" id="ChequeNumber" name="ChequeNumber" placeholder="Cheque Number" maxlength="250">*@
                                                </div><!--end col-->
                                                <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                    @*<label for="pro-end-date">Middle Name</label>*@
                                                    @Html.TextBoxFor(modal => modal.collectMoney.Bank, null, new { @class = "mr-3 form-control", @maxlength = "250", @placeholder = "Bank" })
                                                </div><!--end col-->
                                                <div class="col-lg-4 col-6">
                                                    @*<label for="pro-rate">Last Name</label>*@
                                                    @Html.TextBoxFor(modal => modal.collectMoney.AccountNumber, null, new { @class = "mr-3 form-control", @maxlength = "250", @placeholder = "Account Number" })
                                                </div><!--end col-->
                                            </div><!--end row-->
                                            <br />
                                        </div>
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                    @Html.TextBoxFor(modal => modal.collectMoney.CollectedAmt, null, new { @class = "mr-3 form-control", @maxlength = "250", @placeholder = "Collected Amount" })

                                                </div><!--end col-->
                                                <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                    @*<label for="pro-end-date">Middle Name</label>*@
                                                    @Html.TextBoxFor(modal => modal.collectMoney.BalanceAmt, null, new { @class = "mr-3 form-control", @placeholder = "Collected Amount", @readonly = "readonly" })

                                                </div><!--end col-->
                                            </div>
                                            <br />
                                        </div><!--end form-group-->
                                        <hr />
                                        <div class="form-group">
                                            <div class="row">
                                                <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                    @Html.TextBoxFor(modal => modal.collectMoney.RecivedBy, null, new { @class = "mr-3 form-control", @placeholder = "Amount ReceivedBy", @required = "required" })
                                                    @*<input type="text" class="form-control" id="FirstName" name="FirstName" placeholder="Amount ReceivedBy" maxlength="250">*@
                                                </div><!--end col-->
                                            </div><!--end row-->
                                        </div><!--end form-group-->
                                        @*<div class="form-group">
                                                <div class="row">
                                                    <div class="col-lg-4 col-6 mb-2 mb-lg-0">
                                                        <button type="submit" class="btn btn-primary" id="btnDocument_Next">Collect Payment</button>
                                                    </div>
                                                </div>
                                            </div>*@
                                    </div>
                                </div>

                            </div><!--end card-->
                            <!-- end page title end breadcrumb -->
                        </div>
                    </div>
                </div>
            </div>
            @Html.Partial("_ModalFooter", new ModalFooter())
            @Html.AntiForgeryToken()
            @*}*@
        </div>
    </div>
</div>
<script src="~/Scripts/jquery.min.js"></script>
<script src="~/Content/globalDomain.js"></script>

<script type="text/javascript">

    $("#btn-submit").click(function () {
        //alert("in");
        var partyId = $('#partsummary_PartyId').val();
        var OrderId = $('#partsummary_OrderId').val();
        var PayTrakingId = $('#partsummary_payTrackingId').val();
        var chequenumber = $('#collectMoney_ChequeNumber').val();
        var Bank = $('#collectMoney_Bank').val();
        var Accountno = $('#collectMoney_AccountNumber').val();
        var CollectedAmt = $('#collectMoney_CollectedAmt').val();
        var BalanceAmt = $('#collectMoney_BalanceAmt').val();
        var RrcivedBy = $('#collectMoney_RecivedBy').val();

        var PaymentMoe = $('.resultscore input[type="radio"]:checked').val();
        //$("input:radio[name=collectMoney.PaymentMode]:checked").val();
        //alert(PaymentMoe);
        var modal = {
            payTrackingId: PayTrakingId,
            PartyId: partyId,
            PaymentMode: PaymentMoe,
            ChequeNumber: chequenumber,
            Bank: Bank,
            AccountNumber: Accountno,
            CollectedAmt: CollectedAmt,
            BalanceAmt: BalanceAmt,
            OrderId: OrderId,
            RecivedBy: RrcivedBy
        }
        $.ajax({
            type: "POST",
            url: GetglobalDomain() + "/Home/AddCollectMoney",
            datatype: 'Json',
            data: modal,
            success: function (result) {
                     Swal.fire(
                     'Done!',
                     'Payment Collected Successfully',
                     'success'
                     )
                var url = GetglobalDomain() +'/Home/PaymentPendingCollection';
                     window.location.href = url;
                }
                });
    });

    $(document).ready(function () {
        $('#collectMoney_BalanceAmt').val(@Model.partsummary.BalanceAmount);
        initModalBehaviour();
    });
    function initModalBehaviour() {
        $("#modal-addedit-CollectMoney").on('loaded.bs.modal', function (e) {
            //initFirmDetailControlBehaviour();
            initFormSubmissionBehaviour();
            $(this).on('keyup keypress', function (e) {
                var code = e.keyCode || e.which;
                if (code == 13) {
                    e.preventDefault();
                    return false;
                }
            });
        }
        ).on('hidden.bs.modal', function (e) {
            $(this).removeData('bs.modal');
        });
    }
    function getValue(radio) {
        //alert(radio);
        if (radio.value == "702") {
            $("#divcheque").attr("style", "display:block");
        }
        else {
            clearChequedetails();
            $("#divcheque").attr("style", "display:none");
        }


    }
    function clearChequedetails() {
        $('#collectMoney_ChequeNumber').val('');
        $('#collectMoney_Bank').val('');
        $('#collectMoney_AccountNumber').val('');
    }

    function RemainingBalance() {
        var Grandtotal =@Model.partsummary.BalanceAmount;
        var CollectedAmt = $('#txtCollectedAmt').val();
        var remailBalance = Grandtotal - CollectedAmt;
        $('#collectMoney_BalanceAmt').val(remailBalance);
        //alert(remailBalance);
    }



    function validateFirmDetailsFormData() {
        var validationResults = true;
        var PaymentType = $('input:radio[name=collectMoney_PaymentMode]:checked').val().trim();
        var ChequeNumber = $('#FirmDetailsData_ContactPersonName').val().trim();
        var Bank = $('#FirmDetailsData_ContactPersonDesignation').val().trim();
        var AccountNumber = $('#FirmDetailsData_ContactPersonMobile').val().trim();
        var validationMessage = '';
        if (firmName == '') {
            validationResults = false;
            validationMessage += 'Firm name is not provided<br/>';
        }
        if (contactPersonName == '') {
            validationResults = false;
            validationMessage += 'Contact Person Name is not provided<br/>';
        }
        if (contactPersonDesignation == '') {
            validationResults = false;
            validationMessage += 'Contact Person Designation is not provided<br/>';
        }
        if (contactPersonMobile == '') {
            validationResults = false;
            validationMessage += 'Contact Person Mobile is not provided<br/>';
        }
        if (validationResults == false) {
            showValidationMessage($('.modal-header'), validationMessage);
        }
        return validationResults;
    }

    function initFormSubmissionBehaviour() {

    }
    $('#collectMoney_CollectedAmt').on("input", function () {
        var dInput = this.value;
        var grandtotal = @Model.partsummary.BalanceAmount;
        var BalanceAmt = grandtotal - dInput;
        $('#collectMoney_BalanceAmt').val(BalanceAmt);
    });
</script>





